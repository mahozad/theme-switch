{"version":3,"sources":["theme-switch.js"],"names":[],"mappings":"KAiFM,CAAA,SAAS,CAAG,E,CACZ,SAAS,CAAG,O,CACZ,UAAU,CAAG,M,CACb,UAAU,CAAG,M,CACb,WAAW,CAAG,O,CACd,aAAa,CAAG,W,CAChB,eAAe,CAAG,Y,CAClB,iBAAiB,CAAG,8B,CAGpB,2BAA2B,CAAG,CAAC,EAAD,CAAK,CAAL,CAAQ,EAAR,CAAY,CAAZ,C,CAC9B,2BAA2B,CAAG,CAAC,EAAD,CAAK,CAAL,CAAQ,EAAR,CAAY,CAAZ,C,CAC9B,4BAA4B,CAAG,CAAC,CAAD,CAAI,CAAJ,CAAO,EAAP,CAAW,CAAX,C,CAErC,GAAI,CAAA,UAAJ,CAEA,KAAM,CAAA,kBAAN,QAAiC,CAAA,WAAY,CACzC,WAAW,EAAG,CACV,OADU,CAIV,UAAU,CAAG,KAAK,YAAL,CAAkB,CAAC,IAAI,CAAE,MAAP,CAAlB,CAJH,CAKV,UAAU,CAAC,SAAX,CAAuB,YAAY,CAAC,GAAG,sBAAsB,EAA1B,CALzB,CASV,UAAU,CAAC,IAAX,CAAgB,gBAAhB,CAAiC,OAAjC,CAA0C,WAA1C,CATU,CAaV,KAAM,CAAA,CAAK,CAAG,QAAQ,CAAC,aAAT,CAAuB,OAAvB,CAAd,CACA,CAAK,CAAC,WAAN,CAAoB,aAAa,EAdvB,CAeV,UAAU,CAAC,MAAX,CAAkB,CAAlB,CACH,CAjBwC,CAqB7C,QAAS,CAAA,YAAT,CAAsB,CAAtB,CAAoC,CAApC,CAAiD,CAAjD,CAAiE,CAAjE,CAA+E,CAC3E,MAAQ;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,CAAe;AAC7D;AACA;AACA;AACA;AACA,mLAAmL,CAAa;AAChM;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,CAAY;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,CAAa;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,KACC,CAGD,QAAS,CAAA,aAAT,EAAyB,CACrB,MAAQ;AACZ;AACA;AACA;AACA;AACA,iBAAiB,SAAU;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KACC,CAED,WAAW,E,CACX,MAAM,CAAC,cAAP,CAAsB,MAAtB,CAA6B,cAA7B,CAA6C,kBAA7C,C,CACA,MAAM,CACD,UADL,CACgB,iBADhB,EAEK,gBAFL,CAEsB,QAFtB,CAEgC,WAFhC,C,CAIA,QAAS,CAAA,WAAT,EAAuB,CACnB,GAAI,CAAA,CAAK,CAAG,qBAAqB,EAAjC,CACI,CAAK,GAAK,UAFK,GAEO,CAAK,CAAG,cAAc,EAF7B,EAGnB,QAAQ,CAAC,eAAT,CAAyB,YAAzB,CAAsC,eAAtC,CAAuD,CAAvD,CACH,CAED,QAAS,CAAA,qBAAT,EAAiC,CAC7B,KAAM,CAAA,CAAa,CAAG,YAAY,CAAC,OAAb,CAAqB,SAArB,CAAtB,CACA,MAAyB,KAAlB,GAAA,CAAa,CAAY,aAAZ,CAA4B,CACnD,CAED,QAAS,CAAA,cAAT,EAA0B,CACtB,KAAM,CAAA,CAAM,CAAG,MAAM,CAAC,UAAP,CAAkB,iBAAlB,EAAqC,OAApD,CACA,MAAO,CAAA,CAAM,CAAG,UAAH,CAAgB,WAChC,CAED,QAAS,CAAA,sBAAT,EAAkC,CAC9B,GAAI,CAAA,CAAK,CAAG,qBAAqB,EAAjC,CAD8B,MAE1B,CAAA,CAAK,GAAK,UAFgB,CAGnB,2BAHmB,CAInB,CAAK,GAAK,UAJS,CAKnB,2BALmB,CAOnB,4BAEd,CAGD,QAAS,CAAA,WAAT,EAAuB,CACnB,GAAI,CAAA,CAAK,CAAG,qBAAqB,EAAjC,CACI,CAAK,GAAK,UAFK,EAGf,YAAY,CAAC,OAAb,CAAqB,SAArB,CAAgC,WAAhC,CAHe,CAIf,6BAA6B,EAJd,EAKR,CAAK,GAAK,UALF,EAMf,YAAY,CAAC,OAAb,CAAqB,SAArB,CAAgC,UAAhC,CANe,CAOf,4BAA4B,EAPb,GASf,YAAY,CAAC,OAAb,CAAqB,SAArB,CAAgC,UAAhC,CATe,CAUf,4BAA4B,EAVb,EAYnB,WAAW,EACd,CAED,QAAS,CAAA,6BAAT,EAAyC,CACrC,UAAU,CAAC,cAAX,CAA0B,kBAA1B,EAA8C,YAA9C,EADqC,CAErC,UAAU,CAAC,cAAX,CAA0B,kBAA1B,EAA8C,YAA9C,EAFqC,CAGrC,UAAU,CAAC,cAAX,CAA0B,kBAA1B,EAA8C,YAA9C,EAHqC,CAIrC,UAAU,CAAC,cAAX,CAA0B,gBAA1B,EAA4C,YAA5C,EACH,CAED,QAAS,CAAA,4BAAT,EAAwC,CACpC,UAAU,CAAC,cAAX,CAA0B,iBAA1B,EAA6C,YAA7C,EADoC,CAEpC,UAAU,CAAC,cAAX,CAA0B,kBAA1B,EAA8C,YAA9C,EACH,CAED,QAAS,CAAA,4BAAT,EAAwC,CACpC,UAAU,CAAC,cAAX,CAA0B,gBAA1B,EAA4C,YAA5C,EADoC,CAEpC,UAAU,CAAC,cAAX,CAA0B,mBAA1B,EAA+C,YAA/C,EAFoC,CAGpC,UAAU,CAAC,cAAX,CAA0B,mBAA1B,EAA+C,YAA/C,EACH,CAOqB,WAAlB,QAAO,CAAA,M,GACP,MAAM,CAAC,OAAP,CAAiB,CACb,WADa,CAEb,WAFa,CAGb,cAHa,CAIb,qBAJa,CAKb,sBALa,CAMb,4BANa,CAOb,4BAPa,CAQb,6BARa,C","file":"theme-switch.min.js","sourcesContent":["/*\r\n* NOTE: Do not use this script as an ES6 module.\r\n*  ES6 modules are deferred and we don't want that because\r\n*  we want the user previous theme selection to be applied\r\n*  as soon as possible (before the page is rendered).\r\n* */\r\n\r\n/*\r\n* There are two types of modules mostly used in JavaScript.\r\n* One is created by Node.js and is used inside the Node environment\r\n* and has been available for a long time.\r\n* Another is the standard native JavaScript modules introduced in ES6.\r\n*\r\n* The Node type uses `module.exports` (or simply `exports`) and `require()`\r\n* to export and import functions, properties, etc.\r\n* Because these are arbitrary objects and functions created just in Node environment,\r\n* browsers do not know about `exports` or `require` functions and throw error.\r\n* If you want to use this type of module in browsers, you should bundle the files\r\n* (merge all of them into a single JS file which eliminates the need for exports and require)\r\n* with tools like babel, webpack, etc.\r\n*\r\n* ES6 modules use `export` and `import` keywords for the same purpose.\r\n*\r\n* Example Node modules:\r\n*\r\n* my-calculator.js\r\n* const PI = 3.14;\r\n* function calculate() {}\r\n* modules.exports.calculate = calculate;\r\n* modules.exports.PI = PI;\r\n*\r\n* main.js\r\n* const calculator = require(\"my-calculator\");\r\n* let perimeter = 2 * calculator.PI;\r\n* let result = calculator.calculate();\r\n*\r\n* Example ES6 modules:\r\n*\r\n* my-calculator.js\r\n* const PI = 3.14;\r\n* export function calculate() {}\r\n*\r\n* main.js\r\n* import { calculate, PI } from \"my-calculator.js\";\r\n* let perimeter = 2 * PI;\r\n* let result = calculate();\r\n*\r\n* See https://stackoverflow.com/a/9901097/8583692\r\n* */\r\n\r\n/*\r\n* Minify the script either through command line with babel\r\n* - babel theme-switch.js --presets minify --source-maps --out-file result.min.js\r\n* or with babel-minify (also has an alias called minify) which is useful if\r\n* you don't already use babel (as a preset) or want to run minification standalone.\r\n* Note that it does not take into account babel.config.json settings.\r\n* - babel-minify (or minify) theme-switch.js --mangle --no-comments --out-file result.min.js`\r\n* Or automate it with IntelliJ file watcher\r\n* - babel\r\n*   + program: $ProjectFileDir$\\node_modules\\.bin\\babel\r\n*   + arguments: $FilePathRelativeToProjectRoot$ --out-file $FileNameWithoutExtension$.min.js --presets minify --source-maps\r\n*   Note that setting \"sourceMaps\": \"true\" in babel.config.json does not work because of\r\n*   this bug: https://github.com/babel/babel/issues/5261 (\"sourceMaps\": \"inline\" works, however)\r\n* - UglifyJS\r\n* - YUI compressor (seems to be deprecated and removed in newer versions of IntelliJ)\r\n* */\r\n\r\n/*\r\n* NOTE: To avoid name collisions if another script declares variables or functions with the same name\r\n*  as ours (i.e. defining them in the global scope) and browsers complaining about identifiers\r\n*  being redeclared, we wrap all our code in a closure or IEFE (sort of creating a namespace for it).\r\n* For examples, see these libraries:\r\n*   - https://github.com/highlightjs/highlight.js/blob/main/src/highlight.js\r\n*   - https://github.com/jashkenas/underscore/blob/master/underscore.js\r\n* See\r\n*   - https://stackoverflow.com/a/32750216/8583692\r\n*   - https://stackoverflow.com/q/8228281/8583692\r\n* We could also do something like this library:\r\n*   - https://github.com/juliangarnier/anime/blob/master/build.js\r\n* */\r\n\r\nconst ICON_SIZE = 24 /* px */;\r\nconst THEME_KEY = \"theme\";\r\nconst THEME_AUTO = \"auto\";\r\nconst THEME_DARK = \"dark\";\r\nconst THEME_LIGHT = \"light\";\r\nconst THEME_DEFAULT = THEME_LIGHT;\r\nconst THEME_ATTRIBUTE = \"data-theme\";\r\nconst COLOR_SCHEME_DARK = \"(prefers-color-scheme: dark)\";\r\n\r\n// circleRadius, raysOpacity, eclipseCenterX, letterOffset\r\nconst ICON_INITIAL_STATE_FOR_AUTO = [10, 0, 33, 0];\r\nconst ICON_INITIAL_STATE_FOR_DARK = [10, 0, 20, 1];\r\nconst ICON_INITIAL_STATE_FOR_LIGHT = [5, 1, 33, 1];\r\n\r\nlet shadowRoot;\r\n\r\nclass ThemeSwitchElement extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n\r\n        // See https://stackoverflow.com/q/2305654/8583692\r\n        shadowRoot = this.attachShadow({mode: \"open\"});\r\n        shadowRoot.innerHTML = generateIcon(...getInitialStateForIcon());\r\n\r\n        // Add the click listener to the top-most parent (the custom element itself)\r\n        // so the padding etc. on the element be also clickable\r\n        shadowRoot.host.addEventListener(\"click\", toggleTheme);\r\n\r\n        // Create some CSS to apply to the shadow DOM\r\n        // See https://css-tricks.com/styling-a-web-component/\r\n        const style = document.createElement(\"style\");\r\n        style.textContent = generateStyle();\r\n        shadowRoot.append(style);\r\n    }\r\n}\r\n\r\n// language=html\r\nfunction generateIcon(circleRadius, raysOpacity, eclipseCenterX, letterOffset) {\r\n    return `\r\n    <!-- Using <button> element allows the element to be focused and is more semantic -->\r\n    <button id=\"theme-switch\">\r\n      <!-- See https://stackoverflow.com/q/34393465/8583692 -->\r\n      <svg viewBox=\"0 0 24 24\" width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <defs>\r\n          <mask id=\"mask\">\r\n            <!-- Fill the entire viewBox as the mask default (show everything) -->\r\n            <rect width=\"100%\" height=\"100%\" fill=\"#fff\"/>\r\n            <circle id=\"eclipse\" r=\"10\" cx=\"${eclipseCenterX}\" cy=\"6\">\r\n              <animate id=\"eclipse-anim-come\" fill=\"freeze\" attributeName=\"cx\" to=\"20\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n              <animate id=\"eclipse-anim-go\" fill=\"freeze\" attributeName=\"cx\" to=\"33\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            </circle>\r\n            <!-- See https://youtu.be/7aobRPg7BXI -->\r\n            <path id=\"letter\" fill=\"none\" stroke=\"#000\" stroke-width=\"2\" stroke-linejoin=\"round\" stroke-linecap=\"round\" pathLength=\"1\" stroke-dasharray=\"1 1\" stroke-dashoffset=\"${letterOffset}\" d=\"m8 16.5 4-9 4 9-1-2h-6\">\r\n              <animate id=\"letter-anim-show\" fill=\"freeze\" attributeName=\"stroke-dashoffset\" to=\"0\" dur=\"400ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\".67,.27,.55,.9\"/>\r\n              <animate id=\"letter-anim-hide\" fill=\"freeze\" attributeName=\"stroke-dashoffset\" to=\"1\" dur=\"15ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            </path>\r\n          </mask>\r\n        </defs>\r\n        <g id=\"visible-content\" mask=\"url(#mask)\">\r\n          <g id=\"rays\" opacity=\"${raysOpacity}\" fill=\"none\" stroke=\"#000\" stroke-width=\"2\" stroke-linecap=\"round\">\r\n            <animate id=\"rays-anim-hide\" fill=\"freeze\" attributeName=\"opacity\" to=\"0\" dur=\"100ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            <animate id=\"rays-anim-show\" fill=\"freeze\" attributeName=\"opacity\" to=\"1\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            <animateTransform id=\"rays-anim-rotate\" attributeName=\"transform\" attributeType=\"XML\" type=\"rotate\" from=\"-25 12 12\" to=\"0 12 12\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            <path d=\"m12 1v3\"/>\r\n            <path d=\"m23 12h-3\"/>\r\n            <path d=\"m19.778 4.2218-2.121 2.1213\"/>\r\n            <path d=\"m19.778 19.778-2.121-2.121\"/>\r\n            <path d=\"m4.222 19.778 2.121-2.121\"/>\r\n            <path d=\"m4.222 4.222 2.121 2.121\"/>\r\n            <path d=\"m4 12h-3\"/>\r\n            <path d=\"m12 20v3\"/>\r\n          </g>\r\n          <circle id=\"circle\" r=\"${circleRadius}\" cx=\"12\" cy=\"12\">\r\n            <animate id=\"core-anim-enlarge\" fill=\"freeze\" attributeName=\"r\" to=\"10\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n            <animate id=\"core-anim-shrink\" fill=\"freeze\" attributeName=\"r\" to=\"5\" dur=\"300ms\" begin=\"indefinite\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.37, 0, 0.63, 1\"/>\r\n          </circle>\r\n        </g>\r\n      </svg>\r\n    </button>\r\n    `;\r\n}\r\n\r\n// language=css\r\nfunction generateStyle() {\r\n    return `\r\n    /* :host === the host element of the shadow === <theme-switch> */\r\n    /* See https://developer.mozilla.org/en-US/docs/Web/CSS/:host */\r\n    :host {\r\n        display: flex;\r\n        width: ${ICON_SIZE}px;\r\n        aspect-ratio: 1 / 1;\r\n        /* This is for when the element has padding */\r\n        cursor: pointer;\r\n    }\r\n\r\n    button {\r\n        padding: 0;\r\n        border: none;\r\n        background: transparent;\r\n        display: flex;\r\n        /* The host element also has its cursor set */\r\n        cursor: pointer;\r\n    }\r\n\r\n    /* Only change the color of the core and not rays */\r\n    /* as it seems to make a visually better animation */\r\n    #circle {\r\n        fill: var(--theme-switch-icon-color);\r\n        stroke: var(--theme-switch-icon-color);\r\n    }\r\n    `;\r\n}\r\n\r\nupdateTheme();\r\nwindow.customElements.define(\"theme-switch\", ThemeSwitchElement);\r\nwindow\r\n    .matchMedia(COLOR_SCHEME_DARK)\r\n    .addEventListener(\"change\", updateTheme);\r\n\r\nfunction updateTheme() {\r\n    let theme = getUserThemeSelection();\r\n    if (theme === THEME_AUTO) theme = getSystemTheme();\r\n    document.documentElement.setAttribute(THEME_ATTRIBUTE, theme);\r\n}\r\n\r\nfunction getUserThemeSelection() {\r\n    const userSelection = localStorage.getItem(THEME_KEY);\r\n    return userSelection === null ? THEME_DEFAULT : userSelection;\r\n}\r\n\r\nfunction getSystemTheme() {\r\n    const isDark = window.matchMedia(COLOR_SCHEME_DARK).matches;\r\n    return isDark ? THEME_DARK : THEME_LIGHT;\r\n}\r\n\r\nfunction getInitialStateForIcon() {\r\n    let theme = getUserThemeSelection();\r\n    if (theme === THEME_AUTO) {\r\n        return ICON_INITIAL_STATE_FOR_AUTO;\r\n    } else if (theme === THEME_DARK) {\r\n        return ICON_INITIAL_STATE_FOR_DARK;\r\n    } else /* if (theme === THEME_LIGHT) */ {\r\n        return ICON_INITIAL_STATE_FOR_LIGHT;\r\n    }\r\n}\r\n\r\n// See https://stackoverflow.com/q/48316611\r\nfunction toggleTheme() {\r\n    let theme = getUserThemeSelection();\r\n    if (theme === THEME_AUTO) {\r\n        localStorage.setItem(THEME_KEY, THEME_LIGHT);\r\n        animateThemeButtonIconToLight();\r\n    } else if (theme === THEME_DARK) {\r\n        localStorage.setItem(THEME_KEY, THEME_AUTO);\r\n        animateThemeButtonIconToAuto();\r\n    } else /* if (theme === THEME_LIGHT) */ {\r\n        localStorage.setItem(THEME_KEY, THEME_DARK);\r\n        animateThemeButtonIconToDark();\r\n    }\r\n    updateTheme();\r\n}\r\n\r\nfunction animateThemeButtonIconToLight() {\r\n    shadowRoot.getElementById(\"letter-anim-hide\").beginElement();\r\n    shadowRoot.getElementById(\"core-anim-shrink\").beginElement();\r\n    shadowRoot.getElementById(\"rays-anim-rotate\").beginElement();\r\n    shadowRoot.getElementById(\"rays-anim-show\").beginElement();\r\n}\r\n\r\nfunction animateThemeButtonIconToAuto() {\r\n    shadowRoot.getElementById(\"eclipse-anim-go\").beginElement();\r\n    shadowRoot.getElementById(\"letter-anim-show\").beginElement();\r\n}\r\n\r\nfunction animateThemeButtonIconToDark() {\r\n    shadowRoot.getElementById(\"rays-anim-hide\").beginElement();\r\n    shadowRoot.getElementById(\"core-anim-enlarge\").beginElement();\r\n    shadowRoot.getElementById(\"eclipse-anim-come\").beginElement();\r\n}\r\n\r\n// Export for tests run by npm.\r\n// See https://stackoverflow.com/q/63752210/8583692\r\n// and https://stackoverflow.com/a/54680602/8583692\r\n// and https://stackoverflow.com/q/43042889/8583692\r\n// and https://stackoverflow.com/a/1984728/8583692\r\nif (typeof module !== \"undefined\") {\r\n    module.exports = {\r\n        updateTheme,\r\n        toggleTheme,\r\n        getSystemTheme,\r\n        getUserThemeSelection,\r\n        getInitialStateForIcon,\r\n        animateThemeButtonIconToAuto,\r\n        animateThemeButtonIconToDark,\r\n        animateThemeButtonIconToLight\r\n    };\r\n}\r\n"]}